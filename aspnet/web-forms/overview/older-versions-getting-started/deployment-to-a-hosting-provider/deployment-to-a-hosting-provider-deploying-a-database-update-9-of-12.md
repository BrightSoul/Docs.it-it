---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12
title: 'Distribuzione di un''applicazione Web ASP.NET con SQL Server Compact con Visual Studio o Visual Web Developer: distribuzione di un aggiornamento del Database - 9 di 12 | Documenti Microsoft'
author: tdykstra
description: Questa serie di esercitazioni viene illustrato come distribuire un ASP.NET, pubblicare, progetto di applicazione web che include un database di SQL Server Compact con Visual riceventi...
ms.author: aspnetcontent
manager: wpickett
ms.date: 11/17/2011
ms.topic: article
ms.assetid: a8d776af-4735-4612-87f6-9f326587f2d3
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12
msc.type: authoredcontent
ms.openlocfilehash: 44faca6ac2cdb9193f5c7f6b1d7f5a26e6e22248
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/10/2017
---
<a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-deploying-a-database-update---9-of-12"></a><span data-ttu-id="9ba18-103">Distribuzione di un'applicazione Web ASP.NET con SQL Server Compact con Visual Studio o Visual Web Developer: distribuzione di un aggiornamento del Database - 9 di 12</span><span class="sxs-lookup"><span data-stu-id="9ba18-103">Deploying an ASP.NET Web Application with SQL Server Compact using Visual Studio or Visual Web Developer: Deploying a Database Update - 9 of 12</span></span>
====================
<span data-ttu-id="9ba18-104">Da [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="9ba18-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="9ba18-105">Scaricare il progetto di avvio</span><span class="sxs-lookup"><span data-stu-id="9ba18-105">Download Starter Project</span></span>](http://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> <span data-ttu-id="9ba18-106">Questa serie di esercitazioni viene illustrato come distribuire un ASP.NET, pubblicare, progetto di applicazione web che include un database di SQL Server Compact con Visual Studio 2012 RC o Visual Studio Express 2012 RC per Web.</span><span class="sxs-lookup"><span data-stu-id="9ba18-106">This series of tutorials shows you how to deploy (publish) an ASP.NET web application project that includes a SQL Server Compact database by using Visual Studio 2012 RC or Visual Studio Express 2012 RC for Web.</span></span> <span data-ttu-id="9ba18-107">Se si installa l'aggiornamento di pubblicazione Web, è anche possibile utilizzare Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="9ba18-107">You can also use Visual Studio 2010 if you install the Web Publish Update.</span></span> <span data-ttu-id="9ba18-108">Per un'introduzione alla serie, vedere [la prima esercitazione di serie](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="9ba18-108">For an introduction to the series, see [the first tutorial in the series](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span></span>
> 
> <span data-ttu-id="9ba18-109">Per un'esercitazione che illustra le funzionalità di distribuzione introdotte dopo il rilascio di Visual Studio 2012 RC, viene illustrata l'implementazione di edizioni di SQL Server diverso da SQL Server Compact e viene illustrato come distribuire l'App Web di servizio App di Azure, vedere [distribuzione Web di ASP.NET utilizzo di Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span><span class="sxs-lookup"><span data-stu-id="9ba18-109">For a tutorial that shows deployment features introduced after the RC release of Visual Studio 2012, shows how to deploy SQL Server editions other than SQL Server Compact, and shows how to deploy to Azure App Service Web Apps, see [ASP.NET Web Deployment using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span></span>


## <a name="overview"></a><span data-ttu-id="9ba18-110">Panoramica</span><span class="sxs-lookup"><span data-stu-id="9ba18-110">Overview</span></span>

<span data-ttu-id="9ba18-111">In questa esercitazione è apportare una modifica al database e le modifiche correlate, verificare le modifiche in Visual Studio, quindi distribuire l'aggiornamento in ambienti di test e di produzione.</span><span class="sxs-lookup"><span data-stu-id="9ba18-111">In this tutorial, you make a database change and related code changes, test the changes in Visual Studio, then deploy the update to both the test and production environments.</span></span>

<span data-ttu-id="9ba18-112">Promemoria: Se viene visualizzato un messaggio di errore o non funzioni man mano che Leggi l'esercitazione, assicurarsi di controllare il [risoluzione dei problemi di pagina](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="9ba18-112">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the [troubleshooting page](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span></span>

## <a name="adding-a-new-column-to-a-table"></a><span data-ttu-id="9ba18-113">Aggiunta di una nuova colonna a una tabella</span><span class="sxs-lookup"><span data-stu-id="9ba18-113">Adding a New Column to a Table</span></span>

<span data-ttu-id="9ba18-114">In questa sezione, si aggiunge una colonna di data di nascita per il `Person` classe di base per il `Student` e `Instructor` entità.</span><span class="sxs-lookup"><span data-stu-id="9ba18-114">In this section, you add a birth date column to the `Person` base class for the `Student` and `Instructor` entities.</span></span> <span data-ttu-id="9ba18-115">È quindi necessario aggiornare la pagina che visualizza i dati di istruttore in modo da visualizzare la nuova colonna.</span><span class="sxs-lookup"><span data-stu-id="9ba18-115">Then you update the page that displays instructor data so that it displays the new column.</span></span>

<span data-ttu-id="9ba18-116">Nel *ContosoUniversity.DAL* progetto, aprire *Person* e aggiungere la proprietà seguente alla fine del `Person` classe (dovrebbero essere presenti due parentesi graffe riportata di seguito):</span><span class="sxs-lookup"><span data-stu-id="9ba18-116">In the *ContosoUniversity.DAL* project, open *Person.cs* and add the following property at the end of the `Person` class (there should be two closing curly braces following it):</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample1.cs)]

<span data-ttu-id="9ba18-117">Aggiornare quindi il metodo di inizializzazione in modo che fornisca un valore per la nuova colonna.</span><span class="sxs-lookup"><span data-stu-id="9ba18-117">Next, update the Seed method so that it provides a value for the new column.</span></span> <span data-ttu-id="9ba18-118">Aprire *Migrations\Configuration.cs* e sostituire il blocco di codice che inizia `var instructors = new List<Instructor>` con blocco di codice seguente, che include informazioni sulla data di nascita:</span><span class="sxs-lookup"><span data-stu-id="9ba18-118">Open *Migrations\Configuration.cs* and replace the code block that begins `var instructors = new List<Instructor>` with the following code block which includes birth date information:</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample2.cs)]

<span data-ttu-id="9ba18-119">Nel progetto ContosoUniversity, aprire *Instructors.aspx* e aggiungere un nuovo modello di campo per visualizzare la data di nascita.</span><span class="sxs-lookup"><span data-stu-id="9ba18-119">In the ContosoUniversity project, open *Instructors.aspx* and add a new template field to display the birth date.</span></span> <span data-ttu-id="9ba18-120">Aggiungere il progetto tra quelle per l'assegnazione di office e di data di assunzione:</span><span class="sxs-lookup"><span data-stu-id="9ba18-120">Add it between the ones for hire date and office assignment:</span></span>

[!code-aspx[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample3.aspx)]

<span data-ttu-id="9ba18-121">(Se il rientro di codice ottiene sincronizzato, è possibile premere CTRL-K e CTRL + D per riformattare automaticamente il file.)</span><span class="sxs-lookup"><span data-stu-id="9ba18-121">(If code indentation gets out of sync, you can press CTRL-K and then CTRL-D to automatically reformat the file.)</span></span>

<span data-ttu-id="9ba18-122">Compilare la soluzione e quindi aprire il **Package Manager Console** finestra.</span><span class="sxs-lookup"><span data-stu-id="9ba18-122">Build the solution, and then open the **Package Manager Console** window.</span></span> <span data-ttu-id="9ba18-123">Assicurarsi che ContosoUniversity.DAL sia ancora selezionato come il **progetto predefinito**.</span><span class="sxs-lookup"><span data-stu-id="9ba18-123">Make sure that ContosoUniversity.DAL is still selected as the **Default project**.</span></span>

<span data-ttu-id="9ba18-124">Nel **Package Manager Console** selezionare **ContosoUniversity.DAL** come il **progetto predefinito**, quindi immettere il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="9ba18-124">In the **Package Manager Console** window, select **ContosoUniversity.DAL** as the **Default project**, and then enter the following command:</span></span>

[!code-powershell[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample4.ps1)]

<span data-ttu-id="9ba18-125">Al termine di questo comando, Visual Studio apre il file di classe che definisce la nuova `DbMIgration` (classe) e il `Up` metodo è possibile visualizzare il codice che crea la nuova colonna.</span><span class="sxs-lookup"><span data-stu-id="9ba18-125">When this command finishes, Visual Studio opens the class file that defines the new `DbMIgration` class, and in the `Up` method you can see the code that creates the new column.</span></span>

![AddBirthDate_migration_code](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image1.png)

<span data-ttu-id="9ba18-127">Compilare la soluzione e quindi immettere il comando seguente nel **Package Manager Console** finestra (assicurarsi che sia ancora selezionato il progetto ContosoUniversity.DAL):</span><span class="sxs-lookup"><span data-stu-id="9ba18-127">Build the solution, and then enter the following command in the **Package Manager Console** window (make sure the ContosoUniversity.DAL project is still selected):</span></span>

[!code-powershell[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample5.ps1)]

<span data-ttu-id="9ba18-128">Quando il completamento del comando, eseguire l'applicazione e selezionare la pagina istruttori.</span><span class="sxs-lookup"><span data-stu-id="9ba18-128">When the command finishes, run the application and select the Instructors page.</span></span> <span data-ttu-id="9ba18-129">Quando il caricamento della pagina, vedrai che contiene il nuovo campo Data di nascita.</span><span class="sxs-lookup"><span data-stu-id="9ba18-129">When the page loads, you see that it has the new birth date field.</span></span>

<span data-ttu-id="9ba18-130">[![Instructors_page_with_birth_date](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image3.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="9ba18-130">[![Instructors_page_with_birth_date](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image3.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image2.png)</span></span>

## <a name="deploying-the-database-update-to-the-test-environment"></a><span data-ttu-id="9ba18-131">L'aggiornamento del Database di distribuzione nell'ambiente di testing</span><span class="sxs-lookup"><span data-stu-id="9ba18-131">Deploying the Database Update to the Test Environment</span></span>

<span data-ttu-id="9ba18-132">In **Esplora** selezionare il progetto ContosoUniversity.</span><span class="sxs-lookup"><span data-stu-id="9ba18-132">In **Solution Explorer** select the ContosoUniversity project.</span></span>

<span data-ttu-id="9ba18-133">Nel **Web-pubblicazione con un clic** barra degli strumenti, seleziona il **Test** profilo di pubblicazione e quindi fare clic su **pubblica sul Web**.</span><span class="sxs-lookup"><span data-stu-id="9ba18-133">In the **Web One Click Publish** toolbar, select the **Test** publish profile, and then click **Publish Web**.</span></span> <span data-ttu-id="9ba18-134">(Se la barra degli strumenti è disabilitato, selezionare il progetto ContosoUniversity in **Esplora**.)</span><span class="sxs-lookup"><span data-stu-id="9ba18-134">(If the toolbar is disabled, select the ContosoUniversity project in **Solution Explorer**.)</span></span>

<span data-ttu-id="9ba18-135">Visual Studio distribuisce l'applicazione aggiornata e il browser viene visualizzata la pagina home.</span><span class="sxs-lookup"><span data-stu-id="9ba18-135">Visual Studio deploys the updated application, and the browser opens to the home page.</span></span> <span data-ttu-id="9ba18-136">Eseguire la pagina istruttori per verificare che l'aggiornamento è stato distribuito correttamente.</span><span class="sxs-lookup"><span data-stu-id="9ba18-136">Run the Instructors page to verify that the update was successfully deployed.</span></span> <span data-ttu-id="9ba18-137">Quando l'applicazione tenta di accedere al database per questa pagina, il primo codice aggiorna lo schema del database e viene eseguito il `Seed` metodo.</span><span class="sxs-lookup"><span data-stu-id="9ba18-137">When the application tries to access the database for this page, Code First updates the database schema and runs the `Seed` method.</span></span> <span data-ttu-id="9ba18-138">Quando viene visualizzata la pagina, viene visualizzato il previsto **data di nascita** colonna delle date in essa contenuti.</span><span class="sxs-lookup"><span data-stu-id="9ba18-138">When the page displays, you see the expected **Birth Date** column with dates in it.</span></span>

<span data-ttu-id="9ba18-139">[![Instructors_page_with_birth_date_Test](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9ba18-139">[![Instructors_page_with_birth_date_Test](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image4.png)</span></span>

## <a name="deploying-the-database-update-to-the-production-environment"></a><span data-ttu-id="9ba18-140">L'aggiornamento del Database di distribuzione nell'ambiente di produzione</span><span class="sxs-lookup"><span data-stu-id="9ba18-140">Deploying the Database Update to the Production Environment</span></span>

<span data-ttu-id="9ba18-141">È ora possibile distribuire nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="9ba18-141">You can now deploy to production.</span></span> <span data-ttu-id="9ba18-142">L'unica differenza è che si userà *app\_offline.htm* per impedire agli utenti l'accesso al sito e pertanto l'aggiornamento del database mentre si esegue la distribuzione delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="9ba18-142">The only difference is that you'll use *app\_offline.htm* to prevent users from accessing the site and thus updating the database while you're deploying changes.</span></span> <span data-ttu-id="9ba18-143">Per la distribuzione di produzione, eseguire la procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="9ba18-143">For production deployment perform the following steps:</span></span>

- <span data-ttu-id="9ba18-144">Caricare il *app\_offline.htm* file per il sito di produzione.</span><span class="sxs-lookup"><span data-stu-id="9ba18-144">Upload the *app\_offline.htm* file to the production site.</span></span>
- <span data-ttu-id="9ba18-145">In Visual Studio, scegliere il profilo di produzione nel **Web-pubblicazione con un clic** barra degli strumenti e fare clic su **pubblica sul Web**.</span><span class="sxs-lookup"><span data-stu-id="9ba18-145">In Visual Studio, choose the Production profile in the **Web One Click Publish** toolbar and click **Publish Web**.</span></span>
- <span data-ttu-id="9ba18-146">Eliminare il *app\_offline.htm* file dal sito di produzione.</span><span class="sxs-lookup"><span data-stu-id="9ba18-146">Delete the *app\_offline.htm* file from the production site.</span></span>

> [!NOTE]
> <span data-ttu-id="9ba18-147">Mentre l'applicazione è in uso nell'ambiente di produzione deve implementare un piano di backup.</span><span class="sxs-lookup"><span data-stu-id="9ba18-147">While your application is in use in the production environment you should be implementing a backup plan.</span></span> <span data-ttu-id="9ba18-148">Ovvero, si deve essere periodicamente la copia il *dell'istituto di istruzione-Prod.sdf* e *aspnet Prod.sdf* file dalla produzione del sito in un percorso di archiviazione sicura e si devono mantenere diverse generazioni di tali backup.</span><span class="sxs-lookup"><span data-stu-id="9ba18-148">That is, you should be periodically copying the *School-Prod.sdf* and *aspnet-Prod.sdf* files from the production site to a secure storage location, and you should be keeping several generations of such backups.</span></span> <span data-ttu-id="9ba18-149">Quando si aggiorna il database, è necessario creare una copia di backup da immediatamente prima della modifica.</span><span class="sxs-lookup"><span data-stu-id="9ba18-149">When you update the database, you should make a backup copy from immediately before the change.</span></span> <span data-ttu-id="9ba18-150">Quindi, se si commette un errore e non individuarla solo dopo aver distribuito nell'ambiente di produzione, sarà comunque in grado di ripristinare il database allo stato che precedente danneggiamento.</span><span class="sxs-lookup"><span data-stu-id="9ba18-150">Then, if you make a mistake and don't discover it until after you have deployed it to production, you will still be able to recover the database to the state it was in before it became corrupted.</span></span>


<span data-ttu-id="9ba18-151">Quando Visual Studio apre l'URL della home page nel browser, il *app\_offline.htm* viene visualizzata la pagina.</span><span class="sxs-lookup"><span data-stu-id="9ba18-151">When Visual Studio opens the home page URL in the browser, the *app\_offline.htm* page is displayed.</span></span> <span data-ttu-id="9ba18-152">Dopo aver eliminato il *app\_offline.htm* file, è possibile passare alla home page per verificare che l'aggiornamento è stato distribuito correttamente.</span><span class="sxs-lookup"><span data-stu-id="9ba18-152">After you delete the *app\_offline.htm* file, you can browse to your home page again to verify that the update was successfully deployed.</span></span>

<span data-ttu-id="9ba18-153">[![Instructors_page_with_birth_date_Prod](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image7.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="9ba18-153">[![Instructors_page_with_birth_date_Prod](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image7.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image6.png)</span></span>

<span data-ttu-id="9ba18-154">Ora aver distribuito un aggiornamento di un'applicazione che include una modifica di database di prova e di produzione.</span><span class="sxs-lookup"><span data-stu-id="9ba18-154">You've now deployed an application update that included a database change to both test and production.</span></span> <span data-ttu-id="9ba18-155">L'esercitazione successiva viene illustrato come eseguire la migrazione del database da SQL Server Compact in SQL Server Express e SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9ba18-155">The next tutorial shows you how to migrate your database from SQL Server Compact to SQL Server Express and SQL Server.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="9ba18-156">[Precedente](deployment-to-a-hosting-provider-deploying-a-code-only-update-8-of-12.md)
[Successivo](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12.md)</span><span class="sxs-lookup"><span data-stu-id="9ba18-156">[Previous](deployment-to-a-hosting-provider-deploying-a-code-only-update-8-of-12.md)
[Next](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12.md)</span></span>
