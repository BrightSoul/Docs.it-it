---
title: Durata e la gestione delle chiavi
author: rick-anderson
description: Descrive una durata e la gestione delle chiavi.
keywords: ASP.NET Core, chiave di gestione, DPAPI, DataProtection
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: ef7dad2a-7029-4ae5-8f06-1fbebedccaa4
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/default-settings
ms.openlocfilehash: 5ac2d80e7d1cebcbc792e1247608e67991ec36f4
ms.sourcegitcommit: 8f4d4fad1ca27adf9e396f5c205c9875a3963664
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/13/2017
---
# <a name="key-management-and-lifetime"></a><span data-ttu-id="79517-104">Durata e la gestione delle chiavi</span><span class="sxs-lookup"><span data-stu-id="79517-104">Key management and lifetime</span></span>

<a name="data-protection-default-settings"></a>

## <a name="key-management"></a><span data-ttu-id="79517-105">Gestione delle chiavi</span><span class="sxs-lookup"><span data-stu-id="79517-105">Key Management</span></span>

<span data-ttu-id="79517-106">Il sistema tenta di rilevare l'ambiente operativo e fornire buone impostazioni predefinite di comportamento senza operazioni di configurazione.</span><span class="sxs-lookup"><span data-stu-id="79517-106">The system tries to detect its operational environment and provide good zero-configuration behavioral defaults.</span></span> <span data-ttu-id="79517-107">L'euristica utilizzata è la seguente.</span><span class="sxs-lookup"><span data-stu-id="79517-107">The heuristic used is as follows.</span></span>

1. <span data-ttu-id="79517-108">Se il sistema è ospitato in siti Web di Azure, le chiavi vengono mantenute nella cartella "% HOME%\ASP.NET\DataProtection-Keys".</span><span class="sxs-lookup"><span data-stu-id="79517-108">If the system is being hosted in Azure Web Sites, keys are persisted to the "%HOME%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="79517-109">Questa cartella viene supportata dall'archiviazione di rete e viene sincronizzata in tutti i computer che ospita l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="79517-109">This folder is backed by network storage and is synchronized across all machines hosting the application.</span></span> <span data-ttu-id="79517-110">Le chiavi non sono protette inattivi.</span><span class="sxs-lookup"><span data-stu-id="79517-110">Keys are not protected at rest.</span></span> <span data-ttu-id="79517-111">Questa cartella fornisce la gestione delle chiavi a tutte le istanze di un'applicazione in uno slot di distribuzione singolo.</span><span class="sxs-lookup"><span data-stu-id="79517-111">This folder supplies the key ring to all instances of an application in a single deployment slot.</span></span> <span data-ttu-id="79517-112">Gli slot di distribuzione separato, ad esempio gestione temporanea e produzione, non condividono un anello di chiave.</span><span class="sxs-lookup"><span data-stu-id="79517-112">Separate deployment slots, such as Staging and Production, will not share a key ring.</span></span> <span data-ttu-id="79517-113">Durante lo scambio tra gli slot di distribuzione, ad esempio lo scambio di gestione temporanea nell'ambiente di produzione o utilizzando A / B test, qualsiasi sistema utilizzando la protezione dei dati non sarà in grado di decrittografare i dati archiviati tramite la gestione delle chiavi all'interno di slot precedente.</span><span class="sxs-lookup"><span data-stu-id="79517-113">When you swap between deployment slots, for example swapping Staging to Production or using A/B testing, any system using data protection will not be able to decrypt stored data using the key ring inside the previous slot.</span></span> <span data-ttu-id="79517-114">Questo conduce agli utenti viene disconnettersi dall'applicazione ASP.NET che utilizza middleware del cookie ASP.NET standard, in quanto utilizza la protezione dei dati per proteggere i propri cookie.</span><span class="sxs-lookup"><span data-stu-id="79517-114">This will lead to users being logged out of an ASP.NET application that uses the standard ASP.NET cookie middleware, as it uses data protection to protect its cookies.</span></span> <span data-ttu-id="79517-115">Se si desiderano anelli chiave indipendente di slot, usare un provider di chiavi esterne, ad esempio l'archiviazione di Blob di Azure, insieme di credenziali chiave di Azure, un archivio SQL, oppure cache Redis.</span><span class="sxs-lookup"><span data-stu-id="79517-115">If you desire slot-independent key rings, use an external key ring provider, such as Azure Blob Storage, Azure Key Vault, a SQL store, or Redis cache.</span></span>

2. <span data-ttu-id="79517-116">Se il profilo utente è disponibile, le chiavi vengono mantenute nella cartella "% LOCALAPPDATA%\ASP.NET\DataProtection-Keys".</span><span class="sxs-lookup"><span data-stu-id="79517-116">If the user profile is available, keys are persisted to the "%LOCALAPPDATA%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="79517-117">Inoltre, se il sistema operativo è Windows, verranno crittografate a riposo usando la DPAPI.</span><span class="sxs-lookup"><span data-stu-id="79517-117">Additionally, if the operating system is Windows, they'll be encrypted at rest using DPAPI.</span></span>

3. <span data-ttu-id="79517-118">Se l'applicazione è ospitata in IIS, le chiavi vengono mantenute nel Registro di sistema HKLM in una chiave del Registro di sistema speciale solo per l'account del processo di lavoro.</span><span class="sxs-lookup"><span data-stu-id="79517-118">If the application is hosted in IIS, keys are persisted to the HKLM registry in a special registry key that is ACLed only to the worker process account.</span></span> <span data-ttu-id="79517-119">Le chiavi vengono crittografate a riposo tramite la DPAPI.</span><span class="sxs-lookup"><span data-stu-id="79517-119">Keys are encrypted at rest using DPAPI.</span></span>

4. <span data-ttu-id="79517-120">Se corrisponde a nessuna di queste condizioni, le chiavi non sono persistenti all'esterno del processo corrente.</span><span class="sxs-lookup"><span data-stu-id="79517-120">If none of these conditions matches, keys are not persisted outside of the current process.</span></span> <span data-ttu-id="79517-121">Quando il processo viene arrestato, tutti generati chiavi andranno perse.</span><span class="sxs-lookup"><span data-stu-id="79517-121">When the process shuts down, all generated keys will be lost.</span></span>

<span data-ttu-id="79517-122">Lo sviluppatore è sempre il controllo completo e può eseguire l'override di come e dove sono memorizzate chiavi.</span><span class="sxs-lookup"><span data-stu-id="79517-122">The developer is always in full control and can override how and where keys are stored.</span></span> <span data-ttu-id="79517-123">Le prime tre opzioni sopra devono buona valori predefiniti per la maggior parte delle applicazioni allo stesso modo in ASP.NET <machineKey> routine la generazione automatica funzionavano in passato.</span><span class="sxs-lookup"><span data-stu-id="79517-123">The first three options above should good defaults for most applications similar to how the ASP.NET <machineKey> auto-generation routines worked in the past.</span></span> <span data-ttu-id="79517-124">Finale, l'opzione di failback rientrano è l'unico scenario che realmente richiede allo sviluppatore di specificare [configurazione](overview.md) iniziale se desiderano persistenza chiave, ma questo fallback si verifica solo in rare situazioni.</span><span class="sxs-lookup"><span data-stu-id="79517-124">The final, fall back option is the only scenario that truly requires the developer to specify [configuration](overview.md) upfront if they want key persistence, but this fall-back would only occur in rare situations.</span></span>

>[!WARNING]
> <span data-ttu-id="79517-125">Se lo sviluppatore esegue l'override di questa euristica e indica al sistema di protezione dati in un repository di chiave specifico, la crittografia automatica delle chiavi inattivi verrà disabilitata.</span><span class="sxs-lookup"><span data-stu-id="79517-125">If the developer overrides this heuristic and points the data protection system at a specific key repository, automatic encryption of keys at rest will be disabled.</span></span> <span data-ttu-id="79517-126">Inattivi protezione può essere riabilitata tramite [configurazione](overview.md).</span><span class="sxs-lookup"><span data-stu-id="79517-126">At rest protection can be re-enabled via [configuration](overview.md).</span></span>

## <a name="key-lifetime"></a><span data-ttu-id="79517-127">Durata della chiave</span><span class="sxs-lookup"><span data-stu-id="79517-127">Key Lifetime</span></span>

<span data-ttu-id="79517-128">Le chiavi per impostazione predefinita hanno una durata di 90 giorni.</span><span class="sxs-lookup"><span data-stu-id="79517-128">Keys by default have a 90-day lifetime.</span></span> <span data-ttu-id="79517-129">Quando una chiave scade, il sistema verrà automaticamente generare una nuova chiave e impostare la nuova chiave come chiave attiva.</span><span class="sxs-lookup"><span data-stu-id="79517-129">When a key expires, the system will automatically generate a new key and set the new key as the active key.</span></span> <span data-ttu-id="79517-130">Fino a quando le chiavi ritirate restano nel sistema sarà comunque in grado di decrittografare i dati protetti con essi.</span><span class="sxs-lookup"><span data-stu-id="79517-130">As long as retired keys remain on the system you will still be able to decrypt any data protected with them.</span></span> <span data-ttu-id="79517-131">Vedere [gestione delle chiavi](../implementation/key-management.md#data-protection-implementation-key-management-expiration) per ulteriori informazioni.</span><span class="sxs-lookup"><span data-stu-id="79517-131">See [key management](../implementation/key-management.md#data-protection-implementation-key-management-expiration) for more information.</span></span>

## <a name="default-algorithms"></a><span data-ttu-id="79517-132">Algoritmi predefiniti</span><span class="sxs-lookup"><span data-stu-id="79517-132">Default Algorithms</span></span>

<span data-ttu-id="79517-133">L'algoritmo di protezione dati di payload predefinito utilizzato è AES-256-CBC la riservatezza e HMACSHA256 l'autenticità.</span><span class="sxs-lookup"><span data-stu-id="79517-133">The default payload protection algorithm used is AES-256-CBC for confidentiality and HMACSHA256 for authenticity.</span></span> <span data-ttu-id="79517-134">Una chiave master di 512 bit, il rollback di ogni 90 giorni, viene usata per derivare le due chiavi secondario utilizzate per questi algoritmi in base al payload.</span><span class="sxs-lookup"><span data-stu-id="79517-134">A 512-bit master key, rolled every 90 days, is used to derive the two sub-keys used for these algorithms on a per-payload basis.</span></span> <span data-ttu-id="79517-135">Vedere [sottochiave derivazione](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) per ulteriori informazioni.</span><span class="sxs-lookup"><span data-stu-id="79517-135">See [subkey derivation](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) for more information.</span></span>
