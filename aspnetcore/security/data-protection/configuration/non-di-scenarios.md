---
title: Scenari di supporto DI non
author: rick-anderson
description: 
keywords: ASP.NET Core,
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: a7d8a962-80ff-48e3-96f6-8472b7ba2df9
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/non-di-scenarios
ms.openlocfilehash: 54a930c26f9f48ea0e6f7865e2927bcde0f4d6c0
ms.sourcegitcommit: 0b6c8e6d81d2b3c161cd375036eecbace46a9707
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/11/2017
---
# <a name="non-di-aware-scenarios"></a><span data-ttu-id="9a937-103">Scenari di supporto DI non</span><span class="sxs-lookup"><span data-stu-id="9a937-103">Non DI aware scenarios</span></span>

<span data-ttu-id="9a937-104">Il sistema di protezione dati è in genere progettato [da aggiungere a un contenitore di servizi](../consumer-apis/overview.md) e deve essere fornito per componenti dipendenti tramite un meccanismo DI.</span><span class="sxs-lookup"><span data-stu-id="9a937-104">The data protection system is normally designed [to be added to a service container](../consumer-apis/overview.md) and to be provided to dependent components via a DI mechanism.</span></span> <span data-ttu-id="9a937-105">Tuttavia, potrebbero esserci alcuni casi in cui questo non è possibile, soprattutto quando si importa il sistema in un'applicazione esistente.</span><span class="sxs-lookup"><span data-stu-id="9a937-105">However, there may be some cases where this is not feasible, especially when importing the system into an existing application.</span></span>

<span data-ttu-id="9a937-106">Per supportare questi scenari il pacchetto Microsoft.AspNetCore.DataProtection.Extensions fornisce un tipo concreto DataProtectionProvider che offre un modo semplice per utilizzare il sistema di protezione dati senza passare attraverso i percorsi del codice DI specifiche.</span><span class="sxs-lookup"><span data-stu-id="9a937-106">To support these scenarios the package Microsoft.AspNetCore.DataProtection.Extensions provides a concrete type DataProtectionProvider which offers a simple way to use the data protection system without going through DI-specific code paths.</span></span> <span data-ttu-id="9a937-107">Il tipo stesso implementa IDataProtectionProvider e costruzione, è sufficiente fornire DirectoryInfo in cui le chiavi di crittografia del provider devono essere archiviate.</span><span class="sxs-lookup"><span data-stu-id="9a937-107">The type itself implements IDataProtectionProvider, and constructing it is as easy as providing a DirectoryInfo where this provider's cryptographic keys should be stored.</span></span>

<span data-ttu-id="9a937-108">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="9a937-108">For example:</span></span>

<span data-ttu-id="9a937-109">[!code-none[Principale](non-di-scenarios/_static/nodisample1.cs)]</span><span class="sxs-lookup"><span data-stu-id="9a937-109">[!code-none[Main](non-di-scenarios/_static/nodisample1.cs)]</span></span>

>[!WARNING]
> <span data-ttu-id="9a937-110">Per impostazione predefinita il DataProtectionProvider tipo concreto non consente di crittografare il materiale della chiave non elaborato prima renderli persistenti nel file System.</span><span class="sxs-lookup"><span data-stu-id="9a937-110">By default the DataProtectionProvider concrete type does not encrypt raw key material before persisting it to the file system.</span></span> <span data-ttu-id="9a937-111">Si tratta per supportare scenari in cui condividono i punti di sviluppatori a una rete, nel qual caso il sistema di protezione dati automaticamente non è possibile dedurre un un meccanismo di crittografia con chiave appropriate nel resto.</span><span class="sxs-lookup"><span data-stu-id="9a937-111">This is to support scenarios where the developer points to a network share, in which case the data protection system cannot automatically deduce an appropriate at-rest key encryption mechanism.</span></span>
>
><span data-ttu-id="9a937-112">Inoltre, il tipo concreto DataProtectionProvider non [isolare le applicazioni](overview.md#data-protection-configuration-per-app-isolation) per impostazione predefinita, in modo che tutte le applicazioni a cui fa riferimento alla stessa directory nella chiave possono condividere i payload, purché i relativi parametri di fine corrispondono.</span><span class="sxs-lookup"><span data-stu-id="9a937-112">Additionally, the DataProtectionProvider concrete type does not [isolate applications](overview.md#data-protection-configuration-per-app-isolation) by default, so all applications pointed at the same key directory can share payloads as long as their purpose parameters match.</span></span>

<span data-ttu-id="9a937-113">Lo sviluppatore di applicazioni può soddisfare entrambi questi se lo si desidera.</span><span class="sxs-lookup"><span data-stu-id="9a937-113">The application developer can address both of these if desired.</span></span> <span data-ttu-id="9a937-114">Il costruttore DataProtectionProvider accetta un [callback configurazione facoltativa](overview.md#data-protection-configuration-callback) che può essere usato per modificare i comportamenti del sistema.</span><span class="sxs-lookup"><span data-stu-id="9a937-114">The DataProtectionProvider constructor accepts an [optional configuration callback](overview.md#data-protection-configuration-callback) which can be used to tweak the behaviors of the system.</span></span> <span data-ttu-id="9a937-115">Nell'esempio seguente viene illustrato il ripristino di isolamento tramite una chiamata esplicita a SetApplicationName, e viene inoltre illustrato come configurare il sistema per crittografare automaticamente le chiavi persistenti con DPAPI di Windows.</span><span class="sxs-lookup"><span data-stu-id="9a937-115">The sample below demonstrates restoring isolation via an explicit call to SetApplicationName, and it also demonstrates configuring the system to automatically encrypt persisted keys using Windows DPAPI.</span></span> <span data-ttu-id="9a937-116">Se la directory punta a una condivisione UNC, si consiglia di distribuire un certificato condiviso tra tutti i computer interessati e di configurare il sistema per utilizzare invece la crittografia basata sui certificati mediante una chiamata a [ProtectKeysWithCertificate](overview.md#configuring-x509-certificate).</span><span class="sxs-lookup"><span data-stu-id="9a937-116">If the directory points to a UNC share, you may wish to distribute a shared certificate across all relevant machines and to configure the system to use certificate-based encryption instead via a call to [ProtectKeysWithCertificate](overview.md#configuring-x509-certificate).</span></span>

<span data-ttu-id="9a937-117">[!code-none[Principale](non-di-scenarios/_static/nodisample2.cs)]</span><span class="sxs-lookup"><span data-stu-id="9a937-117">[!code-none[Main](non-di-scenarios/_static/nodisample2.cs)]</span></span>

>[!TIP]
> <span data-ttu-id="9a937-118">Le istanze del tipo concreto DataProtectionProvider sono costose da creare.</span><span class="sxs-lookup"><span data-stu-id="9a937-118">Instances of the DataProtectionProvider concrete type are expensive to create.</span></span> <span data-ttu-id="9a937-119">Se un'applicazione gestisce più istanze di questo tipo e se sta tutti riferimento alla stessa directory di archiviazione chiavi, le prestazioni dell'applicazione potrebbero essere compromesse.</span><span class="sxs-lookup"><span data-stu-id="9a937-119">If an application maintains multiple instances of this type and if they're all pointing at the same key storage directory, application performance may be degraded.</span></span> <span data-ttu-id="9a937-120">L'utilizzo previsto è che lo sviluppatore dell'applicazione, creare un'istanza di questo tipo di una volta quindi mantenere il più possibile riutilizzare questo singolo riferimento.</span><span class="sxs-lookup"><span data-stu-id="9a937-120">The intended usage is that the application developer instantiate this type once then keep reusing this single reference as much as possible.</span></span> <span data-ttu-id="9a937-121">Il tipo DataProtectionProvider e tutte le istanze di oggetto IDataProtector create da quest'ultimo sono thread-safe per più i chiamanti.</span><span class="sxs-lookup"><span data-stu-id="9a937-121">The DataProtectionProvider type and all IDataProtector instances created from it are thread-safe for multiple callers.</span></span>
